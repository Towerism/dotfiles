#!/bin/bash
# -*- mode: shell-script -*-

set -e

DIR_OVERRIDE=$1
DIR=${DIR_OVERRIDE:-$(dirname $(realpath "$0"))}
OPT="-d $DIR"


which stow >/dev/null 2>&1 || { echo "Unable to automatically install dotfiles: stow was not found"; exit 1; }


echo "Stowing modules:"
while read module; do
    printf "  $module... "
    stow $OPT $module
    echo "done"
done < $DIR/modules

printf "Ensuring theme is configured... "
# configure theme if it has not been configured
if [[ ! -a "$HOME/.cache/wal/wal" ]]; then
    printf "\n"
    ~/.scripts/load-theme ~/.wallpapers/elias-forest-landscape-scenery-tx-2560x1440.jpg
fi
printf "done\n"

# Specify the preferences directory
defaults write com.googlecode.iterm2.plist PrefsCustomFolder -string "~/.config/iterm2"
# Tell iTerm2 to use the custom preferences in the directory
defaults write com.googlecode.iterm2.plist LoadPrefsFromCustomFolder -bool true

# install coc npm packages
cd coc/.config/coc/extensions/ && yarn install

ln -sf ~/.cache/wal/itermcolors/ "~/Library/Application\ Support/iTerm2/DynamicProfiles/"
